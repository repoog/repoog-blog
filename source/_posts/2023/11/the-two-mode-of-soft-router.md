---
title: 软路由接入的两种模式
date: 2023-11-26 09:47:55
author: repoog
excerpt: 本文介绍如何使用R2S进行路由接入，以及主路由和旁路由两种不同的接入模式的优点和缺点。
comments: true
tags:
  - R2S
  - 主路由
  - 旁路由
  - 软路由
categories:
  - 网络通讯
---

多年前已经折腾过拿路由器设备刷OpenWRT固件来设置ShadowSocks，甚至早前的路由器自带PPTP、L2TP等VPN功能的时候，可以通过设置L2TP的VPN来直接通过路由器自有的VPN功能实现局域网内的设备科学上网，但可惜的是无论是哪一种，都会面临极大的不稳定的，一方面是来自于连接的不稳定，常常会遇到VPN断开的情况，导致无法正常科学上网，另一方面来自于固件本身的不稳定。

现在，越来越丰富的单板计算机（single board computer）出现，使得不记住路由器设备也可以很容易的构建自己的软路由，这里的“软”是指路由功能并不借助硬件的能力，而是通过设备自身的CPU来处理路由转发，所以软路由依托的硬件设备本身并不是真正意义的路由器设备，而是基于ARM架构或X86架构的普通计算设备，比如一台笔记本、一台主机，或者诸如树莓派这样的单板计算机。

相比树莓派的高价格和高扩展能力，国内厂商还有另外一款广为流传的单板计算机，即友善（friendlyElec）系列的R2S，全程是NanoPi R2S，同系列的还有R2C、R4S、R5S等等。

相比更高系列的R2S的配置虽然不高，但足以作为软路由的基本配置所使用，包括：

* 1.4GHz的CPU；
* 1GB的内存；
* 一个WAN口；
* 一个LAN口；
* 一个USB 2.0口；
* 一个TF卡槽；

只需要8GB的存储，便可轻松容纳OpenWRT系统，再结合当前OpenWRT强大的插件能力，无论是做NAS还是做科学上网都绰绰有余。

软路由的接入模式分为两种思路三种方式：

* 一种思路是将R2S作为主路由使用；
* 一种思路是将R2S作为旁路由使用，其中又分侵入式和非侵入式；

作为旁路有使用由分两种方法，一种方法是不改变主路由的DHCP设置，改变各个连接主路由设备的IP和网关，一种方法是改变主路由的DHCP设置，而不改变各个连接主路由设备的网络配置。

### **主路由模式**

![主路由模式](images/2023/11/primary-router.png '主路由模式')

主路由的优势是所有设备无需做任何配置和修改，但缺点也是这个，一旦软路由发生故障，则会导致所有设备无法上网。

主路由模式下：

1、需要将软路由WAN口接光猫的LAN口，同时将硬路由的WAN口接软路由的LAN口；

2、在软路由中的接口配置中，需要将LAN口的IP段与硬路由的IP段区分设置，如上图中软路由的LAN口IP段是192.168.20.1/24，硬路由的LAN口IP段是192.168.2.1/24，否则会由于IP冲突无法正常上网；

3、最后在软路由系统（OpenWRT）中配置插件等等即可。

### **旁路由模式**

![旁路由模式](images/2023/11/bypass-router.png '旁路由模式')

旁路由的优势是软路由作为主路由的设备接入LAN网，即便软路由发生故障也不影响设备连网，但缺点是需要科学上网的设备需要单独配置IP和DNS，在设备较多的情况下初次配置会较为麻烦。

旁路由模式下：

1、软路由要将LAN口与主路由（硬路由）的LAN口连接（即软路由与主路由在一个子网中）；

2、设置软路由的LAN口IP段与主路由的LAN口IP段保持一致，确保在局域网中设备可以访问到软路由；

3、设置软路由的LAN口的网关为主路由的IP地址（如192.168.2.1），DNS配置主路由IP地址，DHCP服务关闭，避免旁路由故障导致设备无法上网；

4、设置软路由的防火墙配置，关闭SYN Flood功能、Fullcore功能，开启区域转发的IP动态伪装；

配置完成后，需要科学上网的设备需要手动配置IP地址、网关和DNS，其中网关需要配置为软路由IP地址，DNS配置为主路由地址。

以上是非侵入式的旁路由模式，即所有的网络设备无需改动，但需要修改设备的网络配置。

侵入式的旁路由模式中，不需要手动修改设备的网络配置，但需要修改主路由的默认网关，将默认网关修改为旁路由的IP地址，这样所有设备的网关会变为软路由，但缺点是一旦旁路由出现故障，所有设备也无法连网。